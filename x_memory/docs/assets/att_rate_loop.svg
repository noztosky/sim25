<svg viewBox="0 0 1180 420" width="1180" height="420" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" shape-rendering="geometricPrecision" text-rendering="geometricPrecision">
  <defs>
    <style>
      .blk { fill:#2a2a2a; stroke:#999; stroke-width:2; rx:10; ry:10; vector-effect: non-scaling-stroke; }
      .sum { fill:#2a2a2a; stroke:#999; stroke-width:2; vector-effect: non-scaling-stroke; }
      .txt { font: 22px 'Noto Sans KR','Segoe UI',Arial,sans-serif; fill:#eee; }
      .st  { stroke:#bbb; stroke-width:2.5; marker-end:url(#arrow); vector-effect: non-scaling-stroke; }
      .note{ font: 18px 'Noto Sans KR','Segoe UI',Arial,sans-serif; fill:#ccc; }
    </style>
    <marker id="arrow" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M0,0 L12,6 L0,12 z" fill="#bbb"/>
    </marker>
  </defs>

  <!-- 정렬 그리드(표시) : 외곽 한 칸 여백 추가 -->
  <g id="layoutGrid" opacity="0.25">
    <!-- column lines (여백 1칸: 40px) -->
    <line x1="40"  y1="20" x2="40"  y2="400" stroke="#5a5a5a"/>
    <line x1="80"  y1="20" x2="80"  y2="400" stroke="#5a5a5a"/>
    <line x1="300" y1="20" x2="300" y2="400" stroke="#5a5a5a"/>
    <line x1="520" y1="20" x2="520" y2="400" stroke="#5a5a5a"/>
    <line x1="540" y1="20" x2="540" y2="400" stroke="#5a5a5a"/>
    <line x1="760" y1="20" x2="760" y2="400" stroke="#5a5a5a"/>
    <line x1="780" y1="20" x2="780" y2="400" stroke="#5a5a5a"/>
    <line x1="1000" y1="20" x2="1000" y2="400" stroke="#5a5a5a"/>
    <line x1="1140" y1="20" x2="1140" y2="400" stroke="#5a5a5a"/>
    <!-- row lines (여백 1칸: 60px) -->
    <line x1="20" y1="40"  x2="1160" y2="40"  stroke="#5a5a5a"/>
    <line x1="20" y1="100" x2="1160" y2="100" stroke="#5a5a5a"/>
    <line x1="20" y1="160" x2="1160" y2="160" stroke="#5a5a5a"/>
    <line x1="20" y1="220" x2="1160" y2="220" stroke="#5a5a5a"/>
    <line x1="20" y1="280" x2="1160" y2="280" stroke="#5a5a5a"/>
  </g>

  <!-- 외부 루프: Attitude P -->
  <rect class="blk" x="80" y="100" width="220" height="60"></rect>
  <text class="txt" x="98" y="138">자세 참조 θᵣ</text>
  <rect class="blk" x="80" y="160" width="220" height="60"></rect>
  <text class="txt" x="98" y="198">자세 피드백 θ(q)</text>
  <circle class="sum" cx="320" cy="130" r="16"/>
  <text class="txt" x="314" y="137">Σ</text>
  <line class="st" x1="300" y1="130" x2="304" y2="130"/>
  <line class="st" x1="300" y1="190" x2="320" y2="130"/>
  <text class="note" x="168" y="100">eθ = θᵣ − θ</text>
  <rect class="blk" x="340" y="100" width="220" height="60"/>
  <text class="txt" x="370" y="138">Attitude P</text>
  <text class="note" x="370" y="162">ωᵣ = Kp·eθ</text>
  <line class="st" x1="336" y1="130" x2="340" y2="130"/>

  <!-- 내부 루프: Rate PI + D -->
  <circle class="sum" cx="570" cy="130" r="16"/>
  <text class="txt" x="564" y="137">Σ</text>
  <line class="st" x1="560" y1="130" x2="554" y2="130"/>
  <text class="note" x="510" y="120">ωᵣ</text>
  <rect class="blk" x="580" y="100" width="220" height="60"/>
  <text class="txt" x="624" y="138">Rate PI</text>
  <text class="note" x="604" y="162">조건부 적분, anti‑windup</text>
  <line class="st" x1="340" y1="130" x2="554" y2="130"/>

  <rect class="blk" x="820" y="160" width="220" height="60"/>
  <text class="txt" x="888" y="198">D‑term</text>
  <text class="note" x="848" y="220">PT2×2, 클램프</text>
  <line class="st" x1="800" y1="130" x2="820" y2="190"/>

  <rect class="blk" x="1020" y="220" width="180" height="60"></rect>
  <text class="txt" x="1030" y="258">제어 출력 → PWM</text>

  <!-- 자이로 경로 -->
  <rect class="blk" x="580" y="220" width="220" height="60"/>
  <text class="txt" x="602" y="258">자이로 ω (PT2×2)</text>
  <line class="st" x1="690" y1="220" x2="570" y2="146"/>
  <text class="note" x="694" y="206">−ω</text>

  <!-- 합성 출력 -->
  <circle class="sum" cx="1000" cy="250" r="16"/>
  <text class="txt" x="994" y="256">Σ</text>
  <line class="st" x1="800" y1="130" x2="1000" y2="250"/>
  <line class="st" x1="1040" y1="190" x2="1000" y2="250"/>
  <line class="st" x1="1016" y1="250" x2="1020" y2="250"/>
  <text class="note" x="822" y="120">PI 출력</text>
  <text class="note" x="1044" y="210">+ D</text>
</svg>


