<svg viewBox="0 0 1180 520" width="1180" height="520" xmlns="http://www.w3.org/2000/svg" preserveAspectRatio="xMidYMid meet" shape-rendering="geometricPrecision" text-rendering="geometricPrecision">
  <defs>
    <style>
      .blk { fill:#2a2a2a; stroke:#999; stroke-width:2; rx:10; ry:10; vector-effect: non-scaling-stroke; }
      .sum { fill:#2a2a2a; stroke:#999; stroke-width:2; vector-effect: non-scaling-stroke; }
      .txt { font: 24px 'Noto Sans KR', 'Segoe UI', Arial, sans-serif; fill:#eee; }
      .st  { stroke:#bbb; stroke-width:2.5; marker-end:url(#arrow); vector-effect: non-scaling-stroke; }
      .st2 { stroke:#888; stroke-dasharray:6 6; stroke-width:2; marker-end:url(#arrow); vector-effect: non-scaling-stroke; }
      .note{ font: 18px 'Noto Sans KR', 'Segoe UI', Arial, sans-serif; fill:#ccc; }
    </style>
    <marker id="arrow" markerWidth="12" markerHeight="12" refX="10" refY="6" orient="auto">
      <path d="M0,0 L12,6 L0,12 z" fill="#bbb"></path>
    </marker>
  </defs>
  <!-- 보이지 않는 정렬 그리드 -->
  <g id="layoutGrid" opacity="0">
    <!-- cols: 20, 240, 480, 720, 960 / rows: 20, 120, 180, 300, 380 -->
    <rect x="20"  y="20"  width="200" height="80"  fill="#000"/>
    <rect x="240" y="20"  width="200" height="80"  fill="#000"/>
    <rect x="480" y="20"  width="200" height="80"  fill="#000"/>
    <rect x="720" y="20"  width="200" height="80"  fill="#000"/>
    <rect x="960" y="20"  width="200" height="80"  fill="#000"/>

    <rect x="20"  y="120" width="200" height="60"  fill="#000"/>
    <rect x="240" y="120" width="200" height="60"  fill="#000"/>
    <rect x="480" y="120" width="200" height="60"  fill="#000"/>
    <rect x="720" y="120" width="200" height="60"  fill="#000"/>
    <rect x="960" y="120" width="200" height="60"  fill="#000"/>

    <rect x="20"  y="180" width="200" height="70"  fill="#000"/>
    <rect x="240" y="180" width="200" height="70"  fill="#000"/>
    <rect x="480" y="180" width="200" height="70"  fill="#000"/>
    <rect x="720" y="180" width="200" height="70"  fill="#000"/>
    <rect x="960" y="180" width="200" height="70"  fill="#000"/>

    <rect x="20"  y="300" width="200" height="60"  fill="#000"/>
    <rect x="240" y="300" width="200" height="60"  fill="#000"/>
    <rect x="480" y="300" width="200" height="60"  fill="#000"/>
    <rect x="720" y="300" width="200" height="60"  fill="#000"/>
    <rect x="960" y="300" width="200" height="60"  fill="#000"/>
  </g>

  <!-- 입력 -->
  <rect class="blk" x="20" y="40" width="160" height="40"></rect>
  <text class="txt" x="40" y="66">Gyro ω</text>
  <rect class="blk" x="20" y="170" width="160" height="40"></rect>
  <text class="txt" x="40" y="196">Accel a</text>
  <!-- 합점(ω + 보정 - bias) -->
  <circle class="sum" cx="360" cy="60" r="18"></circle>
  <text class="txt" x="352" y="69">Σ</text>
  <!-- 바이어스 차감 입력 -->
  <line class="st" x1="360" y1="140" x2="360" y2="78"></line>
  <text class="note" x="368" y="112">− b̂</text>
  <!-- Gyro → Σ -->
  <line class="st" x1="180" y1="60" x2="342" y2="60"></line>
  <!-- 보정(Kp e) → Σ -->
  <line class="st" x1="360" y1="260" x2="360" y2="78"></line>
  <text class="note" x="370" y="232">+ Kp · e</text>
  <!-- Σ → 적분기 -->
  <rect class="blk" x="420" y="20" width="240" height="80"></rect>
  <text class="txt" x="440" y="70">쿼터니언 적분 dq/dt</text>
  <line class="st" x1="378" y1="60" x2="420" y2="60"></line>
  <!-- 적분기 → 정규화 -->
  <rect class="blk" x="700" y="20" width="200" height="80"></rect>
  <text class="txt" x="722" y="70">정규화 q ← q / |q|</text>
  <line class="st" x1="660" y1="60" x2="700" y2="60"></line>
  <!-- q → g_hat -->
  <rect class="blk" x="950" y="20" width="190" height="80"></rect>
  <text class="txt" x="972" y="70">중력 방향 êg(q)</text>
  <line class="st" x1="900" y1="60" x2="950" y2="60"></line>
  <!-- Accel 경로: 정규화/신뢰도 -->
  <rect class="blk" x="200" y="150" width="260" height="70"></rect>
  <text class="txt" x="215" y="195">â ← a / |a|, 신뢰도 α(EMA, |a|≈g)</text>
  <line class="st" x1="180" y1="190" x2="200" y2="190"></line>
  <text class="note" x="40" y="230">|a|≈g 구간만 사용, α=EMA(τ)</text>
  <!-- 에러 계산 e = êg × â -->
  <rect class="blk" x="520" y="150" width="230" height="70"></rect>
  <text class="txt" x="535" y="196">e ← α · ( êg × â )</text>
  <line class="st" x1="330" y1="185" x2="520" y2="185"></line>
  <line class="st" x1="1045" y1="110" x2="635" y2="150"></line>
  <text class="note" x="980" y="130">êg</text>
  <!-- 비례 경로 Kp e → Σ -->
  <rect class="blk" x="320" y="230" width="80" height="60"></rect>
  <text class="txt" x="338" y="268">Kp</text>
  <line class="st" x1="520" y1="185" x2="400" y2="230"></line>
  <!-- 적분 경로 Ki ∫ e → bias -->
  <rect class="blk" x="200" y="300" width="120" height="60"></rect>
  <text class="txt" x="224" y="340">Ki ∫</text>
  <line class="st" x1="635" y1="220" x2="320" y2="330"></line>
  <rect class="blk" x="340" y="300" width="180" height="60"></rect>
  <text class="txt" x="352" y="340">바이어스 추정 b̂</text>
  <line class="st" x1="430" y1="300" x2="360" y2="140"></line>
  <!-- 메모 -->
  <text class="note" x="40" y="410">정지/저가속에서 b̂ 업데이트 우선, 외란 시 α↓</text>
  <text class="note" x="40" y="440">매 스텝 q 정규화로 수치 안정성 보장</text>
</svg>


